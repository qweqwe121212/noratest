# -*- coding: utf-8 -*-

"""
قوالب الأوامر لخدمة النموذج اللغوي.
"""

# قالب تحديد ما إذا كان الاستعلام متعلقًا بالعقارات
REAL_ESTATE_QUERY_TEMPLATE = """
المهمة: تحديد ما إذا كانت الرسالة التالية تتعلق بالبحث عن سكن أو عقار أو مرافق أم لا.

رسالة المستخدم:
{user_message}

قواعد التقييم:
1. إذا كانت الرسالة تتعلق بالبحث عن سكن، أو شراء/استئجار عقار، أو طلب حي مناسب، أو أسئلة عن أسعار العقارات، أو البحث عن المرافق (مدارس، مستشفيات، حدائق، مولات، الخ) = نعم
2. إذا كانت الرسالة تتعلق بموضوع آخر تماماً مثل الرياضة، الطعام، الفن، السياسة، أو تحية عامة = لا

المطلوب: قم بتحليل الرسالة والرد فقط بـ "نعم" أو "لا" دون أي كلمات أخرى.
"""

# قالب توليد رد للاستعلامات خارج النطاق
OFF_TOPIC_RESPONSE_TEMPLATE = """
أنت مساعد للبحث عن العقارات والمرافق، لكن المستخدم سأل سؤالاً خارج نطاق تخصصك.

رسالة المستخدم:
{user_message}

مهمتك:
1. الرد بطريقة مهذبة ولطيفة على سؤال المستخدم بشكل مختصر
2. توجيه المستخدم بلطف إلى أن هذا الشاتبوت متخصص في العقارات والبحث عن سكن والمرافق
3. دعوة المستخدم للسؤال عن احتياجاته السكنية أو المرافق التي يبحث عنها

قواعد مهمة:
- كن ودوداً ومهذباً
- لا تتجاهل سؤال المستخدم تماماً
- قدم إجابة مختصرة عن السؤال إذا كان ممكناً
- لا تستخدم أسلوب اعتذار مبالغ فيه
- ذكّر المستخدم بلطف أن الشاتبوت متخصص في العقارات والمرافق
- شجع المستخدم على طرح أسئلة متعلقة بالسكن والعقارات والمرافق

الرد يجب أن يكون باللغة العربية الفصحى.
"""

# قالب تصنيف نوع الاستعلام
QUERY_TYPE_CLASSIFICATION_TEMPLATE = """
أنت الآن مصنف للرسائل، استناداً على محتوى الرسالة، قم بتحديد نوع الاستفسار من بين الخيارات التالية:

- ترحيب: رسائل الترحيب العامة أو رسائل البدء
- استفسار_عادي: استفسارات عامة لا تتطلب استجابة محددة 
- اقتراح_حي: رسائل تتعلق ببحث عن حي أو مكان مناسب للسكن
- مرافق_عامة: رسائل تتعلق بالبحث عن مرافق بشكل عام (مدارس، مستشفيات، حدائق، الخ) دون تحديد نوع معين
- مدرسة: رسائل تتعلق بالبحث عن اسم مدرسة
- مول: رسائل تتعلق بالبحث عن اسم مول
- مستشفى: رسائل تتعلق بالبحث عن اسم مستشفى 
- حديقة: رسائل تتعلق بالبحث عن اسم حديقة
- سوبرماركت: رسائل تتعلق بالبحث عن سوبرماركت

الرسالة: 
{user_message}

نوع الاستفسار (كلمة واحدة فقط):
"""

# قالب استخراج الكيان
ENTITY_EXTRACTION_TEMPLATE = """
استخرج {entity_type} من الرسالة التالية. إذا لم يكن هناك {entity_type}، أعد كلمة "عام".

الرسالة:
{message}

{entity_type}:
"""

# قالب البحث عن الحالات المشابهة
SIMILARITY_SEARCH_TEMPLATE = """
أمامك قائمة من الحالات السابقة للمستخدمين مع الأحياء المقترحة لهم.

حالة المستخدم الحالي:
{user_message}

قائمة الحالات السابقة:
{knowledge_cases_json}

المطلوب منك:
1. قم بتحليل محتوى حالة المستخدم وابحث عن كلمات مفتاحية مهمة مثل (موقع، ميزانية، عدد أفراد، احتياجات خاصة، الخ)
2. قارن هذه الكلمات المفتاحية مع الحالات في قاعدة المعرفة
3. حدد أكثر 3 حالات مشابهة وقم بحساب نسبة التشابه لكل حالة بشكل دقيق
4. ترتيب الحالات تنازلياً حسب نسبة التشابه

ملاحظات هامة جداً:
- لا تحدد نسبة تشابه أعلى من الواقع، كن واقعياً ودقيقاً في تحديد نسبة التشابه
- إذا كان التشابه ضعيفاً، فلا تتردد في إعطاء نسبة منخفضة (مثلاً 20% أو 15%)
- احرص على تنويع النسب المئوية بناءً على درجة التشابه الفعلية
- لا تقم بتعيين نسبة افتراضية أو حد أدنى للنسب
- تأكد من أن تكون النسب منطقية وتعكس التشابه الحقيقي

أعد النتائج بتنسيق JSON كالتالي:
```json
[
  {{
    "رقم_الحالة": [رقم الحالة],
    "نسبة_التشابه": [النسبة المئوية للتشابه],
    "الحي_المقترح": [اسم الحي المقترح],
    "سبب_التشابه": [شرح مختصر لسبب اعتبار هذه الحالة مشابهة]
  }},
  ...
]
```

قدم النتائج بتنسيق JSON فقط دون أي نص إضافي.
"""